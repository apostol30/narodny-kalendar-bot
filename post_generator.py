from PIL import Image, ImageDraw, ImageFont, ImageFilter
import os
import math
import json
from datetime import datetime
import textwrap
import random

# –†–∞–∑–º–µ—Ä –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
CARD_WIDTH = 1200
CARD_HEIGHT = 630

# –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞
COLORS = {
    "bg_light": (245, 240, 235),
    "bg_dark": (230, 225, 220),
    "text_dark": (40, 35, 30),
    "text_light": (100, 90, 80),
    "accent_gold": (180, 150, 100),
    "accent_green": (120, 150, 110),
    "accent_blue": (100, 130, 150),
    "accent_red": (170, 100, 90),
    "accent_purple": (150, 110, 160),
}

# –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –¥–∞–Ω–Ω—ã–º–∏
DATA_DIR = "data"

def load_data_for_day(theme, day, month):
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–Ω—è –∏ —Ç–µ–º—ã –∏–∑ JSON-—Ñ–∞–π–ª–æ–≤"""
    try:
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–π–ª –¥–ª—è —Ç–µ–º—ã
        theme_files = {
            "primeta": "primety.json",
            "saint": "saints.json",
            "holiday": "holidays.json",
            "hero": "heroes.json",
            "actor": "actors.json",
            "wisdom": "wisdom.json",
            "lunar": "lunar.json",
            "history": "history.json",
            "herbal": "herbal.json",
            "art": "art.json",
            "food": "food.json",
            "house": "house.json",
            "craft": "craft.json",
            "advice": "advice.json",
            "prayer": "prayers.json",
        }
        
        filename = theme_files.get(theme)
        if not filename:
            return get_default_data(theme)
        
        filepath = os.path.join(DATA_DIR, filename)
        
        if not os.path.exists(filepath):
            return get_default_data(theme)
        
        with open(filepath, 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # –ò—â–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–Ω—è (—Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞: "1-1" –¥–ª—è 1 —è–Ω–≤–∞—Ä—è, "2-1" –¥–ª—è 2 —è–Ω–≤–∞—Ä—è –∏ —Ç.–¥.)
        key = f"{day}-{month}"
        
        if key in data:
            return data[key]
        else:
            return get_default_data(theme)
            
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
        return get_default_data(theme)

def get_default_data(theme):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–µ–º—ã"""
    defaults = {
        "primeta": {
            "text": "–°–µ–≥–æ–¥–Ω—è –æ—Å–æ–±—ã–π –¥–µ–Ω—å. –ü—Ä–∏—Ä–æ–¥–∞ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç: –Ω–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –∑–Ω–∞–∫–∞–º–∏ –≤–æ–∫—Ä—É–≥."
        },
        "saint": {
            "name": "–°–≤—è—Ç–æ–π —É–≥–æ–¥–Ω–∏–∫",
            "description": "–ü–æ—á–∏—Ç–∞–µ–º—ã–π —Å–≤—è—Ç–æ–π, –º–æ–ª–∏—Ç–≤–µ–Ω–Ω–∏–∫ –∏ –∑–∞—Å—Ç—É–ø–Ω–∏–∫.",
            "prayer": "–ì–æ—Å–ø–æ–¥–∏, –ø–æ–º–∏–ª—É–π –Ω–∞—Å –ø–æ –º–æ–ª–∏—Ç–≤–∞–º —Å–≤—è—Ç—ã—Ö –¢–≤–æ–∏—Ö."
        },
        "holiday": {
            "title": "–î–µ–Ω—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ",
            "description": "–≠—Ç–æ—Ç –¥–µ–Ω—å –∏–º–µ–µ—Ç –æ—Å–æ–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ç—Ä–∞–¥–∏—Ü–∏—è—Ö –Ω–∞—à–µ–≥–æ –Ω–∞—Ä–æ–¥–∞.",
            "orthodox": "–¶–µ—Ä–∫–æ–≤—å —á—Ç–∏—Ç –ø–∞–º—è—Ç—å —Å–≤—è—Ç—ã—Ö —ç—Ç–æ–≥–æ –¥–Ω—è.",
            "state": "–î–µ–Ω—å, –æ—Ç–º–µ—á–µ–Ω–Ω—ã–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞—à–µ–≥–æ –û—Ç–µ—á–µ—Å—Ç–≤–∞."
        },
        "hero": {
            "name": "–ì–µ—Ä–æ–π –û—Ç–µ—á–µ—Å—Ç–≤–∞",
            "bio": "–ü—Ä–∏–º–µ—Ä –º—É–∂–µ—Å—Ç–≤–∞, –≤–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –ª—é–±–≤–∏ –∫ –†–æ–¥–∏–Ω–µ.",
            "deed": "–ü–æ–¥–≤–∏–≥, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –ø–æ–∫–æ–ª–µ–Ω–∏–π.",
            "full_story": "–ò—Ö –∂–∏–∑–Ω—å - –ø—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–¥—Ä–∞–∂–∞–Ω–∏—è. –û–Ω–∏ —à–ª–∏ –Ω–∞ –ø–æ–¥–≤–∏–≥ –Ω–µ —Ä–∞–¥–∏ —Å–ª–∞–≤—ã, –∞ —Ä–∞–¥–∏ –†–æ–¥–∏–Ω—ã, —Ä–∞–¥–∏ –Ω–∞—Å —Å –≤–∞–º–∏. –¢–∞–∫–∏—Ö –ª—é–¥–µ–π –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –∏ —á—Ç–∏—Ç—å."
        },
        "actor": {
            "name": "–°–æ–≤–µ—Ç—Å–∫–∏–π –∞–∫—Ç—ë—Ä",
            "years": "XXXX-XXXX",
            "bio": "–¢–∞–ª–∞—Ç–Ω–ª–∏–≤—ã–π –∞—Ä—Ç–∏—Å—Ç, —á—å—ë —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ —Å—Ç–∞–ª–æ —á–∞—Å—Ç—å—é –Ω–∞—à–µ–π –∫—É–ª—å—Ç—É—Ä—ã.",
            "roles": "–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –≤ –∫–∏–Ω–æ –∏ —Ç–µ–∞—Ç—Ä–µ.",
            "full_story": "–ò—Ö —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ - –∑–æ–ª–æ—Ç–æ–π —Ñ–æ–Ω–¥ —Å–æ–≤–µ—Ç—Å–∫–æ–≥–æ –∫–∏–Ω–æ. –û–Ω–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–≥—Ä–∞–ª–∏ —Ä–æ–ª–∏ - –æ–Ω–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–ª–∏ –±–ª–∏–∑–∫–∏ –º–∏–ª–ª–∏–æ–Ω–∞–º –∑—Ä–∏—Ç–µ–ª–µ–π."
        },
        "wisdom": {
            "text": "–ú—É–¥—Ä–æ—Å—Ç—å –ø—Ä–µ–¥–∫–æ–≤ - –≤ –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª–æ–≤–∞—Ö –≥–ª—É–±–æ—á–∞–π—à–∏–π —Å–º—ã—Å–ª.",
            "explanation": "–≠—Ç–∞ –º—É–¥—Ä–æ—Å—Ç—å –ø—Ä–æ—à–ª–∞ —á–µ—Ä–µ–∑ –≤–µ–∫–∞, —Å–æ—Ö—Ä–∞–Ω—è—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∏ —Å–µ–≥–æ–¥–Ω—è."
        },
        "lunar": {
            "day": 1,
            "phase": "–Ω–æ–≤–∞—è –ª—É–Ω–∞",
            "advice": "–í—Ä–µ–º—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π.",
            "detailed": "–õ—É–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ —Ä–∏—Ç–º—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞. –°–ª–µ–¥—É–π—Ç–µ —Å–æ–≤–µ—Ç–∞–º –ø—Ä–µ–¥–∫–æ–≤, —Å–æ–≥–ª–∞—Å—É—è —Å–≤–æ–∏ –¥–µ–ª–∞ —Å –ª—É–Ω–Ω—ã–º –∫–∞–ª–µ–Ω–¥–∞—Ä—ë–º."
        }
    }
    
    return defaults.get(theme, {"text": "–°–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π –æ —Ç—Ä–∞–¥–∏—Ü–∏—è—Ö –∏ –º—É–¥—Ä–æ—Å—Ç–∏."})

def get_color_by_theme(theme):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–∞ –ø–æ —Ç–µ–º–µ –ø–æ—Å—Ç–∞"""
    colors = {
        "primeta": COLORS["accent_green"],
        "saint": COLORS["accent_gold"],
        "holiday": COLORS["accent_red"],
        "hero": COLORS["accent_red"],
        "lunar": COLORS["accent_blue"],
        "wisdom": COLORS["accent_gold"],
        "history": COLORS["accent_blue"],
        "herbal": COLORS["accent_green"],
        "art": COLORS["accent_gold"],
        "food": COLORS["accent_red"],
        "house": COLORS["accent_green"],
        "craft": COLORS["accent_blue"],
        "actor": COLORS["accent_purple"],
        "advice": COLORS["accent_green"],
        "prayer": COLORS["accent_gold"],
    }
    return colors.get(theme, COLORS["accent_gold"])

def get_theme_title(theme):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–º—ã –ø–æ ID"""
    titles = {
        "primeta": "üåæ –ù–ê–†–û–î–ù–ê–Ø –ü–†–ò–ú–ï–¢–ê",
        "saint": "‚õ™ –°–í–Ø–¢–û–ô –î–ù–Ø",
        "holiday": "üéâ –ü–†–ê–ó–î–ù–ò–ö –î–ù–Ø",
        "hero": "‚≠ê –ß–¢–û–ë–´ –ü–û–ú–ù–ò–õ–ò",
        "lunar": "üåô –õ–£–ù–ù–´–ô –ö–ê–õ–ï–ù–î–ê–†–¨",
        "wisdom": "üó£Ô∏è –ú–£–î–†–û–°–¢–¨ –î–ù–Ø",
        "history": "üìú –î–ï–ù–¨ –í –ò–°–¢–û–†–ò–ò",
        "herbal": "üåø –¢–†–ê–í–ù–ò–ö –î–ù–Ø",
        "art": "üé® –ò–°–ö–£–°–°–¢–í–û –î–ù–Ø",
        "food": "üçû –ö–£–•–ù–Ø –ü–†–ï–î–ö–û–í",
        "house": "üè° –î–û–ú –ò –£–ö–õ–ê–î",
        "craft": "‚öíÔ∏è –†–ï–ú–ï–°–õ–û –î–ù–Ø",
        "actor": "üé¨ –°–û–í–ï–¢–°–ö–ò–ï –ê–ö–¢–Å–†–´",
        "advice": "üîÆ –°–û–í–ï–¢ –î–ù–Ø",
        "prayer": "üïØÔ∏è –í–ï–ß–ï–†–ù–Ø–Ø –ú–û–õ–ò–¢–í–ê",
    }
    return titles.get(theme, "–ù–ê–†–û–î–ù–´–ô –ö–ê–õ–ï–ù–î–ê–†–¨")

def get_theme_hashtags(theme, name=None):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ö–µ—à—Ç–µ–≥–∏ –¥–ª—è —Ç–µ–º—ã"""
    base_tags = {
        "primeta": ["#–ü—Ä–∏–º–µ—Ç–∞", "#–ù–∞—Ä–æ–¥–Ω–∞—è–ú—É–¥—Ä–æ—Å—Ç—å", "#–ö–∞–ª–µ–Ω–¥–∞—Ä—å"],
        "saint": ["#–°–≤—è—Ç–æ–π", "#–ü—Ä–∞–≤–æ—Å–ª–∞–≤–∏–µ", "#–ú–æ–ª–∏—Ç–≤–∞"],
        "holiday": ["#–ü—Ä–∞–∑–¥–Ω–∏–∫", "#–¢—Ä–∞–¥–∏—Ü–∏–∏", "#–ò—Å—Ç–æ—Ä–∏—è"],
        "hero": ["#–ß—Ç–æ–±—ã–ü–æ–º–Ω–∏–ª–∏", "#–ì–µ—Ä–æ–∏", "#–ü–æ–¥–≤–∏–≥"],
        "lunar": ["#–õ—É–Ω–∞", "#–ö–∞–ª–µ–Ω–¥–∞—Ä—å", "#–°–æ–≤–µ—Ç—ã"],
        "wisdom": ["#–ú—É–¥—Ä–æ—Å—Ç—å", "#–ü–æ—Å–ª–æ–≤–∏—Ü–∞", "#–ù–∞—Ä–æ–¥–Ω–∞—è–ú—É–¥—Ä–æ—Å—Ç—å"],
        "history": ["#–ò—Å—Ç–æ—Ä–∏—è", "#–ü–∞–º—è—Ç—å", "#–†–æ—Å—Å–∏—è"],
        "herbal": ["#–¢—Ä–∞–≤—ã", "#–ó–¥–æ—Ä–æ–≤—å–µ", "#–ù–∞—Ä–æ–¥–Ω–∞—è–ú–µ–¥–∏—Ü–∏–Ω–∞"],
        "art": ["#–ò—Å–∫—É—Å—Å—Ç–≤–æ", "#–ö—É–ª—å—Ç—É—Ä–∞", "#–†—É—Å—Å–∫–æ–µ–ò—Å–∫—É—Å—Å—Ç–≤–æ"],
        "food": ["#–ö—É—Ö–Ω—è", "#–¢—Ä–∞–¥–∏—Ü–∏–∏", "#–†–µ—Ü–µ–ø—Ç—ã"],
        "house": ["#–î–æ–º", "#–°–µ–º—å—è", "#–¢—Ä–∞–¥–∏—Ü–∏–∏"],
        "craft": ["#–†–µ–º–µ—Å–ª–æ", "#–¢—Ä–∞–¥–∏—Ü–∏–∏", "#–ù–∞—Ä–æ–¥–Ω—ã–µ–ü—Ä–æ–º—ã—Å–ª—ã"],
        "actor": ["#–ê–∫—Ç–µ—Ä—ã", "#–ö–∏–Ω–æ", "#–°–°–°–†"],
        "advice": ["#–°–æ–≤–µ—Ç", "#–ú—É–¥—Ä–æ—Å—Ç—å", "#–ù–∞—Ä–æ–¥–Ω—ã–µ–°–æ–≤–µ—Ç—ã"],
        "prayer": ["#–ú–æ–ª–∏—Ç–≤–∞", "#–í–µ—Ä–∞", "#–ü—Ä–∞–≤–æ—Å–ª–∞–≤–∏–µ"],
    }
    
    tags = base_tags.get(theme, ["#–ù–∞—Ä–æ–¥–Ω—ã–π–ö–∞–ª–µ–Ω–¥–∞—Ä—å", "#–¢—Ä–∞–¥–∏—Ü–∏–∏", "#–†–æ—Å—Å–∏—è"])
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–π
    if name and theme in ["hero", "actor", "saint"]:
        clean_name = name.replace(" ", "_").replace("-", "_")
        tags.append(f"#{clean_name}")
    
    return tags

def get_current_date_text():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ '1 —è–Ω–≤–∞—Ä—è'"""
    now = datetime.now()
    months = [
        "—è–Ω–≤–∞—Ä—è", "—Ñ–µ–≤—Ä–∞–ª—è", "–º–∞—Ä—Ç–∞", "–∞–ø—Ä–µ–ª—è", "–º–∞—è", "–∏—é–Ω—è",
        "–∏—é–ª—è", "–∞–≤–≥—É—Å—Ç–∞", "—Å–µ–Ω—Ç—è–±—Ä—è", "–æ–∫—Ç—è–±—Ä—è", "–Ω–æ—è–±—Ä—è", "–¥–µ–∫–∞–±—Ä—è"
    ]
    return f"{now.day} {months[now.month-1]}"

def create_horizontal_card(theme, title_line2=None):
    """–°–æ–∑–¥–∞—ë—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É 1200√ó630"""
    img = Image.new('RGB', (CARD_WIDTH, CARD_HEIGHT), color=COLORS["bg_light"])
    draw = ImageDraw.Draw(img)
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —à—Ä–∏—Ñ—Ç—ã
    try:
        font_title = ImageFont.truetype("fonts/CormorantGaramond-Bold.ttf", 68)
        font_subtitle = ImageFont.truetype("fonts/CormorantGaramond-SemiBold.ttf", 52)
        font_date = ImageFont.truetype("fonts/PTSerif-Regular.ttf", 38)
    except:
        try:
            font_title = ImageFont.truetype("CormorantGaramond-Bold.ttf", 68)
            font_subtitle = ImageFont.truetype("CormorantGaramond-SemiBold.ttf", 52)
            font_date = ImageFont.truetype("PTSerif-Regular.ttf", 38)
        except:
            font_title = ImageFont.load_default()
            font_subtitle = ImageFont.load_default()
            font_date = ImageFont.load_default()
    
    accent_color = get_color_by_theme(theme)
    
    # –î–µ–∫–æ—Ä - –ª–µ–≤–∞—è –ø–æ–ª–æ—Å–∞
    draw.rectangle([0, 0, 80, CARD_HEIGHT], fill=accent_color)
    
    # –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: —Ç–µ–º–∞ –ø–æ—Å—Ç–∞
    theme_title = get_theme_title(theme)
    draw.text((120, 70), theme_title, fill=COLORS["text_dark"], font=font_title)
    
    # –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if title_line2:
        max_width = CARD_WIDTH - 200
        if draw.textlength(title_line2, font=font_subtitle) > max_width:
            while draw.textlength(title_line2 + "...", font=font_subtitle) > max_width and len(title_line2) > 10:
                title_line2 = title_line2[:-1]
            title_line2 = title_line2 + "..."
        
        draw.text((120, 145), title_line2, fill=accent_color, font=font_subtitle)
    
    # –î–∞—Ç–∞
    date_text = get_current_date_text()
    date_width = draw.textlength(date_text, font=font_date)
    draw.text((CARD_WIDTH - date_width - 50, CARD_HEIGHT - 60), 
              date_text, fill=COLORS["text_light"], font=font_date)
    
    # –°–∏–º–≤–æ–ª —Ç–µ–º—ã (–ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª)
    symbol_x, symbol_y = CARD_WIDTH - 100, 100
    symbol_size = 30
    
    if theme == "saint":
        # –ö—Ä–µ—Å—Ç
        draw.line([(symbol_x-15, symbol_y), (symbol_x+15, symbol_y)], 
                 fill=accent_color, width=3)
        draw.line([(symbol_x, symbol_y-15), (symbol_x, symbol_y+15)], 
                 fill=accent_color, width=3)
    elif theme == "hero":
        # –ó–≤–µ–∑–¥–∞ –≥–µ—Ä–æ—è
        star_points = []
        for i in range(5):
            angle = math.radians(90 + i * 72)
            star_points.append((symbol_x + symbol_size * math.cos(angle), 
                               symbol_y - symbol_size * math.sin(angle)))
        draw.polygon(star_points, fill=accent_color)
    elif theme == "holiday":
        # –§–µ–π–µ—Ä–≤–µ—Ä–∫
        for i in range(3):
            offset_x = symbol_x + (i-1)*15
            offset_y = symbol_y + (i-1)*15
            color = [COLORS["accent_red"], COLORS["accent_gold"], COLORS["accent_blue"]][i]
            draw.ellipse([offset_x-10, offset_y-10, offset_x+10, offset_y+10], fill=color)
    elif theme == "actor":
        # –¢–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ –º–∞—Å–∫–∏
        draw.ellipse([symbol_x-25, symbol_y-15, symbol_x, symbol_y+15], 
                     outline=accent_color, width=3)
        draw.ellipse([symbol_x, symbol_y-15, symbol_x+25, symbol_y+15], 
                     outline=accent_color, width=3)
    elif theme == "lunar":
        # –õ—É–Ω–∞
        draw.ellipse([symbol_x-symbol_size, symbol_y-symbol_size,
                     symbol_x+symbol_size, symbol_y+symbol_size], 
                     outline=accent_color, width=3)
    else:
        # –ö–Ω–∏–≥–∞ (–æ–±—â–∏–π —Å–∏–º–≤–æ–ª)
        draw.rectangle([symbol_x-25, symbol_y-20, symbol_x+25, symbol_y+20], 
                      outline=accent_color, width=2)
        for i in range(-2, 3):
            draw.line([(symbol_x-20, symbol_y+i*5), (symbol_x+20, symbol_y+i*5)], 
                     fill=accent_color, width=1)
    
    return img

def generate_long_post_text(theme, day_data):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤)"""
    current_date = get_current_date_text()
    
    # –®–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –ø–æ—Å—Ç–∞ (—Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –≤–µ—Ä—Å–∏–∏)
    templates = {
        "primeta": (
            f"–ë—Ä–∞—Ç—å—è, —Å–µ–≥–æ–¥–Ω—è {current_date}, –∏ –Ω–∞—Å—Ç—É–ø–∏–ª–æ –≤—Ä–µ–º—è –≤—Å–ø–æ–º–Ω–∏—Ç—å –Ω–∞—Ä–æ–¥–Ω—É—é –ø—Ä–∏–º–µ—Ç—É —ç—Ç–æ–≥–æ –¥–Ω—è.\n\n"
            f"<b>–ü—Ä–∏–º–µ—Ç–∞:</b>\n{day_data.get('text', '–ü—Ä–∏—Ä–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è –æ—Å–æ–±–µ–Ω–Ω–∞—è ‚Äî –ø—Ä–∏—Å–º–æ—Ç—Ä–∏—Ç–µ—Å—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, –∏ –æ–Ω–∞ –ø–æ–¥—Å–∫–∞–∂–µ—Ç, –∫–∞–∫–∏–º –±—É–¥–µ—Ç –¥–µ–Ω—å.')}\n\n"
            f"<b>–ó–Ω–∞—á–µ–Ω–∏–µ:</b>\n–ù–∞—à–∏ –ø—Ä–µ–¥–∫–∏ –≤–µ–∫–∞–º–∏ –Ω–∞–±–ª—é–¥–∞–ª–∏ –∑–∞ –ø—Ä–∏—Ä–æ–¥–æ–π, –æ—Ç–º–µ—á–∞—è –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏. "
            f"–≠—Ç–∞ –ø—Ä–∏–º–µ—Ç–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å—É–µ–≤–µ—Ä–∏–µ, –∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å –ø–æ–∫–æ–ª–µ–Ω–∏–π, –ø–æ–º–æ–≥–∞–≤—à–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ª–∞, —Å–µ–≤ –∏ —É–±–æ—Ä–∫—É —É—Ä–æ–∂–∞—è.\n\n"
            f"<b>–°–æ–≤–µ—Ç –¥–Ω—è:</b>\n–ü–æ–Ω–∞–±–ª—é–¥–∞–π—Ç–µ —Å–µ–≥–æ–¥–Ω—è –∑–∞ –æ–∫—Ä—É–∂–∞—é—â–∏–º –º–∏—Ä–æ–º. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∑–∞–º–µ—Ç–∏—Ç–µ —Ç–æ, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç –Ω–∞—Ä–æ–¥–Ω—É—é –º—É–¥—Ä–æ—Å—Ç—å.\n\n"
        ),
        "saint": (
            f"–î—Ä—É–∑—å—è, —Å–µ–≥–æ–¥–Ω—è {current_date} –ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–∞—è –¶–µ—Ä–∫–æ–≤—å —á—Ç–∏—Ç –ø–∞–º—è—Ç—å {day_data.get('name', '—Å–≤—è—Ç–æ–≥–æ —É–≥–æ–¥–Ω–∏–∫–∞ –ë–æ–∂–∏—è')}.\n\n"
            f"<b>–ñ–∏—Ç–∏–µ:</b>\n{day_data.get('description', '–≠—Ç–æ—Ç —Å–≤—è—Ç–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ—á–∏—Ç–∞–µ–º –≤ –Ω–∞—Ä–æ–¥–µ –∑–∞ –ø–æ–º–æ—â—å –≤ –∂–∏—Ç–µ–π—Å–∫–∏—Ö –Ω—É–∂–¥–∞—Ö –∏ –∏—Å—Ü–µ–ª–µ–Ω–∏–µ –Ω–µ–¥—É–≥–æ–≤.')}\n\n"
            f"<b>–ú–æ–ª–∏—Ç–≤–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:</b>\n¬´{day_data.get('prayer', '–ì–æ—Å–ø–æ–¥–∏, –ø–æ–º–∏–ª—É–π –∏ —Å–ø–∞—Å–∏ –Ω–∞—Å –ø–æ –º–æ–ª–∏—Ç–≤–∞–º —Å–≤—è—Ç—ã—Ö –¢–≤–æ–∏—Ö. –ê–º–∏–Ω—å.')}¬ª\n\n"
            f"<b>–û —á—ë–º –º–æ–ª—è—Ç—Å—è:</b>\n–≠—Ç–æ–º—É —Å–≤—è—Ç–æ–º—É —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –º–æ–ª—è—Ç—Å—è –æ {day_data.get('pray_for', '–∑–¥—Ä–∞–≤–∏–∏, —Å–µ–º–µ–π–Ω–æ–º –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–∏ –∏ –ø–æ–º–æ—â–∏ –≤ —Ç—Ä—É–¥–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö')}.\n\n"
            f"–ü—É—Å—Ç—å –µ–≥–æ —Å–≤—è—Ç—ã–µ –º–æ–ª–∏—Ç–≤—ã —É–∫—Ä–µ–ø—è—Ç –Ω–∞—Å –≤ –≤–µ—Ä–µ –∏ –ø–æ–º–æ–≥—É—Ç –≤ –¥–æ–±—Ä—ã—Ö –¥–µ–ª–∞—Ö.\n\n"
        ),
        "holiday": (
            f"–¢–æ–≤–∞—Ä–∏—â–∏, —Å–µ–≥–æ–¥–Ω—è {current_date} ‚Äî {day_data.get('title', '–æ—Å–æ–±—ã–π –¥–µ–Ω—å –≤ –Ω–∞—Ä–æ–¥–Ω–æ–º –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ')}.\n\n"
            f"<b>–ó–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞:</b>\n{day_data.get('description', '–≠—Ç–æ—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ –∏–º–µ–µ—Ç –≥–ª—É–±–æ–∫–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ—Ä–Ω–∏ –∏ –±–æ–≥–∞—Ç—ã–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏, –ø–µ—Ä–µ–¥–∞—é—â–∏–µ—Å—è –∏–∑ –ø–æ–∫–æ–ª–µ–Ω–∏—è –≤ –ø–æ–∫–æ–ª–µ–Ω–∏–µ.')}\n\n"
            f"<b>üìú –ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</b>\n{day_data.get('orthodox', '–í —ç—Ç–æ—Ç –¥–µ–Ω—å –¶–µ—Ä–∫–æ–≤—å –æ—Ç–º–µ—á–∞–µ—Ç –≤–∞–∂–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ —á—Ç–∏—Ç –ø–∞–º—è—Ç—å —Å–≤—è—Ç—ã—Ö.')}\n\n"
            f"<b>üèõÔ∏è –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</b>\n{day_data.get('state', '–î–ª—è –Ω–∞—à–µ–π —Å—Ç—Ä–∞–Ω—ã —ç—Ç–æ—Ç –¥–µ–Ω—å –∏–º–µ–µ—Ç –æ—Å–æ–±–æ–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –∏ –∫—É–ª—å—Ç—É—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.')}\n\n"
            f"<b>–¢—Ä–∞–¥–∏—Ü–∏–∏:</b>\n{day_data.get('traditions', '–í —ç—Ç–æ—Ç –¥–µ–Ω—å –ø—Ä–∏–Ω—è—Ç–æ —Å–æ–±–∏—Ä–∞—Ç—å—Å—è —Å–µ–º—å—ë–π, –≤—Å–ø–æ–º–∏–Ω–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏ —Å–æ–±–ª—é–¥–∞—Ç—å –Ω–∞—Ä–æ–¥–Ω—ã–µ –æ–±—ã—á–∞–∏.')}\n\n"
            f"–î–∞–≤–∞–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —ç—Ç–∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏ –Ω–∞—à–∏–º –¥–µ—Ç—è–º!\n\n"
        ),
        "hero": (
            f"–ë—Ä–∞—Ç—å—è, —Å–µ–≥–æ–¥–Ω—è {current_date} –º—ã —Å –æ—Å–æ–±–æ–π –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é –≤—Å–ø–æ–º–∏–Ω–∞–µ–º {day_data.get('name', '–Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –≥–µ—Ä–æ—è –Ω–∞—à–µ–≥–æ –û—Ç–µ—á–µ—Å—Ç–≤–∞')}.\n\n"
            f"<b>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</b>\n{day_data.get('bio', '–ï–≥–æ –∂–∏–∑–Ω—å ‚Äî —è—Ä–∫–∏–π –ø—Ä–∏–º–µ—Ä –±–µ–∑–∑–∞–≤–µ—Ç–Ω–æ–≥–æ —Å–ª—É–∂–µ–Ω–∏—è –†–æ–¥–∏–Ω–µ, –º—É–∂–µ—Å—Ç–≤–∞ –∏ —Å–∞–º–æ–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è.')}\n\n"
            f"<b>‚≠ê –ü–æ–¥–≤–∏–≥:</b>\n{day_data.get('deed', '–û–Ω —Å–æ–≤–µ—Ä—à–∏–ª —Ç–æ, —á—Ç–æ –Ω–∞–≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –Ω–∞—à–µ–π –ø–∞–º—è—Ç–∏ –∫–∞–∫ —Å–∏–º–≤–æ–ª –æ—Ç–≤–∞–≥–∏ –∏ –ª—é–±–≤–∏ –∫ –†–æ–¥–∏–Ω–µ.')}\n\n"
            f"<b>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</b>\n{day_data.get('full_story', '–ò—Ö –ø–æ–¥–≤–∏–≥–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–±—ã—Ç—ã. –û–Ω–∏ —à–ª–∏ –Ω–∞ —Å–º–µ—Ä—Ç—å –Ω–µ —Ä–∞–¥–∏ —Å–ª–∞–≤—ã, –∞ —Ä–∞–¥–∏ –±—É–¥—É—â–µ–≥–æ —Å–≤–æ–µ–π —Å—Ç—Ä–∞–Ω—ã, —Ä–∞–¥–∏ –Ω–∞—Å —Å –≤–∞–º–∏. '
            f'–ü–∞–º—è—Ç—å –æ —Ç–∞–∫–∏—Ö –ª—é–¥—è—Ö ‚Äî —ç—Ç–æ –Ω–∞—à –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–ª–≥ –∏ –æ—Å–Ω–æ–≤–∞ –ø–∞—Ç—Ä–∏–æ—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è.')}\n\n"
            f"–í–µ—á–Ω–∞—è –ø–∞–º—è—Ç—å –≥–µ—Ä–æ—è–º! –í–µ—á–Ω–∞—è —Å–ª–∞–≤–∞!\n\n"
        ),
        "actor": (
            f"–î—Ä—É–∑—å—è, —Å–µ–≥–æ–¥–Ω—è {current_date} —Ä–æ–¥–∏–ª—Å—è {day_data.get('name', '–∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç—Å–∫–∏–π –∞–∫—Ç—ë—Ä')} "
            f"({day_data.get('years', '–≥–æ–¥—ã –∂–∏–∑–Ω–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞')}).\n\n"
            f"<b>–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø—É—Ç—å:</b>\n{day_data.get('bio', '–ï–≥–æ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ —Å—Ç–∞–ª–æ –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é –Ω–∞—à–µ–π –∫—É–ª—å—Ç—É—Ä—ã, –∞ –º–Ω–æ–≥–∏–µ —Ä–æ–ª–∏ ‚Äî –ª—é–±–∏–º—ã–º–∏ –¥–ª—è –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∑—Ä–∏—Ç–µ–ª–µ–π.')}\n\n"
            f"<b>üé¨ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–æ–ª–∏:</b>\n{day_data.get('roles', '–ú–Ω–æ–≥–∏–µ –µ–≥–æ —Ä–∞–±–æ—Ç—ã —Å—Ç–∞–ª–∏ –∫–ª–∞—Å—Å–∏–∫–æ–π —Å–æ–≤–µ—Ç—Å–∫–æ–≥–æ –∏ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∫–∏–Ω–æ, —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –æ—Ç–º–µ—á–∞–ª–∏—Å—å –∫—Ä–∏—Ç–∏–∫–∞–º–∏ –∏ –∑—Ä–∏—Ç–µ–ª—è–º–∏.')}\n\n"
            f"<b>–ù–∞—Å–ª–µ–¥–∏–µ:</b>\n{day_data.get('full_story', '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ —ç—Ç–∏—Ö –∞–∫—Ç—ë—Ä–æ–≤ ‚Äî –∑–æ–ª–æ—Ç–æ–π —Ñ–æ–Ω–¥ –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∞. '
            f'–û–Ω–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–≥—Ä–∞–ª–∏ —Ä–æ–ª–∏ ‚Äî –æ–Ω–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–ª–∏ –±–ª–∏–∑–∫–∏ –º–∏–ª–ª–∏–æ–Ω–∞–º, –æ—Ç—Ä–∞–∂–∞–ª–∏ —ç–ø–æ—Ö—É –∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤ –ø–∞–º—è—Ç–∏. '
            f'–ò—Ö —Ç–∞–ª–∞–Ω—Ç ‚Äî –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ—Å—Ç–æ—è–Ω–∏–µ.')}\n\n"
            f"–î–∞–≤–∞–π—Ç–µ –ø–æ–º–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Ö –ª—É—á—à–∏–µ —Ä–∞–±–æ—Ç—ã!\n\n"
        ),
        "wisdom": (
            f"–ù–∞—Ä–æ–¥–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å –Ω–∞ {current_date}:\n\n"
            f"<b>–ü–æ—Å–ª–æ–≤–∏—Ü–∞/–ü–æ–≥–æ–≤–æ—Ä–∫–∞:</b>\n¬´{day_data.get('text', '–£–º–Ω–æ–º—É —Å–ª–æ–≤–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –∞ –≥–ª—É–ø–æ–º—É –∏ –ø–ª–µ—Ç—å –Ω–µ –ø–æ–º–æ–∂–µ—Ç.')}¬ª\n\n"
            f"<b>üìñ –ó–Ω–∞—á–µ–Ω–∏–µ:</b>\n{day_data.get('explanation', '–ö–∞–∫ —Ç–æ—á–Ω–æ –ø–æ–¥–º–µ—á–µ–Ω–æ –Ω–∞—à–∏–º–∏ –ø—Ä–µ–¥–∫–∞–º–∏! –í —ç—Ç–æ–π –∫—Ä–∞—Ç–∫–æ–π —Ñ—Ä–∞–∑–µ ‚Äî –∏ –≤–µ–∫–æ–≤–∞—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∏ –∂–∏—Ç–µ–π—Å–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è, –∏ –≥–ª—É–±–æ–∫–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è.')}\n\n"
            f"<b>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –∂–∏–∑–Ω–∏:</b>\n–≠—Ç–∞ –º—É–¥—Ä–æ—Å—Ç—å —É—á–∏—Ç –Ω–∞—Å {day_data.get('application', '—Ü–µ–Ω–∏—Ç—å —É–º –∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –Ω–∞—Å–∏–ª–∏–µ–º –Ω–µ–ª—å–∑—è –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ–Ω—è—Ç—å —Ç–æ, —á—Ç–æ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å–ª–æ–≤–æ –∏ —Ä–∞–∑—É–º.')}\n\n"
            f"–ú—É–¥—Ä–æ—Å—Ç—å –ø—Ä–µ–¥–∫–æ–≤ ‚Äî –±–µ—Å—Ü–µ–Ω–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ. –•—Ä–∞–Ω–∏—Ç–µ –µ—ë –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –¥–µ—Ç—è–º.\n\n"
        ),
        "lunar": (
            f"–ë—Ä–∞—Ç—å—è, —Å–µ–≥–æ–¥–Ω—è {current_date} ‚Äî {day_data.get('day', '1')}-–π –ª—É–Ω–Ω—ã–π –¥–µ–Ω—å.\n\n"
            f"<b>–§–∞–∑–∞ –õ—É–Ω—ã:</b> {day_data.get('phase', '—Ä–∞—Å—Ç—É—â–∞—è')}\n\n"
            f"<b>üí° –°–æ–≤–µ—Ç –¥–Ω—è:</b>\n{day_data.get('advice', '–≠—Ç–æ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞—á–∞–ª–∞ –≤–∞–∂–Ω—ã—Ö –¥–µ–ª.')}\n\n"
            f"<b>–ü–æ–¥—Ä–æ–±–Ω–µ–µ:</b>\n{day_data.get('detailed', '–õ—É–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ —Ä–∏—Ç–º—ã, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —ç–Ω–µ—Ä–≥–∏—é —á–µ–ª–æ–≤–µ–∫–∞. '
            f'–ù–∞—à–∏ –ø—Ä–µ–¥–∫–∏ —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–ª–∏ —ç—Ç–∏ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–ª–∏ —Å –Ω–∏–º–∏ —Å–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã, –ª–µ—á–µ–Ω–∏–µ –∏ –≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.')}\n\n"
            f"<b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è:</b>\n{day_data.get('actions', '–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ, –º–µ—á—Ç–∞–π—Ç–µ, –∑–∞–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –æ—Å–Ω–æ–≤—ã –±—É–¥—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.')}\n\n"
            f"–°–ª–µ–¥—É–π—Ç–µ –º—É–¥—Ä–æ—Å—Ç–∏ –ø—Ä–µ–¥–∫–æ–≤ ‚Äî –∂–∏–≤–∏—Ç–µ –≤ –≥–∞—Ä–º–æ–Ω–∏–∏ —Å –ø—Ä–∏—Ä–æ–¥–Ω—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏!\n\n"
        ),
    }
    
    # –ë–µ—Ä—ë–º —à–∞–±–ª–æ–Ω –¥–ª—è —Ç–µ–º—ã –∏–ª–∏ –æ–±—â–∏–π
    base_text = templates.get(theme, 
        f"–°–µ–≥–æ–¥–Ω—è {current_date}, –∏ –≤ –Ω–∞—Ä–æ–¥–Ω–æ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è –µ—Å—Ç—å –æ—Å–æ–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.\n\n"
        f"{day_data.get('text', '–≠—Ç–æ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π –æ —Ç—Ä–∞–¥–∏—Ü–∏—è—Ö, –º—É–¥—Ä–æ—Å—Ç–∏ –ø—Ä–µ–¥–∫–æ–≤ –∏ –Ω–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏.')}\n\n"
        f"–î–∞–≤–∞–π—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —ç—Ç–∏ –∑–Ω–∞–Ω–∏—è –¥–∞–ª—å—à–µ ‚Äî –æ–Ω–∏ –Ω–∞—à–µ –¥—É—Ö–æ–≤–Ω–æ–µ –∏ –∫—É–ª—å—Ç—É—Ä–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ, –æ—Å–Ω–æ–≤–∞ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏—è.\n\n"
        f"–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è ‚Äî —ç—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–æ–ª—å—à–æ–π –∫–Ω–∏–≥–∏ –Ω–∞—à–µ–π –æ–±—â–µ–π –ø–∞–º—è—Ç–∏.\n\n"
    )
    
    return base_text

def generate_telegram_post(theme, day_data):
    """–°–æ–∑–¥–∞—ë—Ç —Ç–µ–∫—Å—Ç –¥–ª—è Telegram –ø–æ—Å—Ç–∞ —Å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏"""
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    long_text = generate_long_post_text(theme, day_data)
    
    # –•–µ—à—Ç–µ–≥–∏
    name = day_data.get('name')
    hashtags = get_theme_hashtags(theme, name)
    hashtag_text = " ".join(hashtags[:3])  # –ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 3 —Ö–µ—à—Ç–µ–≥–∞
    
    # –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤ HTML —Ñ–æ—Ä–º–∞—Ç–µ
    telegram_link = "<a href='https://t.me/narodny_kalendar'>–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</a>"
    rutube_link = "<a href='https://rutube.ru/channel/23605491/'>–°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ Rutube</a>"
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
    full_text = (
        f"{long_text}\n"
        f"{hashtag_text}\n\n"
        f"üëâ {telegram_link}\n"
        f"üì∫ {rutube_link}"
    )
    
    # Telegram –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 1024 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∫ —Ñ–æ—Ç–æ
    if len(full_text) > 1024:
        # –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±—Ä–µ–∑–∞–µ–º —Ç–µ–∫—Å—Ç
        telegram_limit = 1024
        # –í—ã—á–∏—Ç–∞–µ–º –¥–ª–∏–Ω—É —Ö–µ—à—Ç–µ–≥–æ–≤ –∏ —Å—Å—ã–ª–æ–∫
        footer_length = len(f"\n\n{hashtag_text}\n\nüëâ {telegram_link}\nüì∫ {rutube_link}")
        available_text_length = telegram_limit - footer_length
        
        # –û–±—Ä–µ–∑–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç
        if len(long_text) > available_text_length:
            # –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç–æ—á–∫—É –ø–µ—Ä–µ–¥ –ª–∏–º–∏—Ç–æ–º
            truncated = long_text[:available_text_length]
            last_period = truncated.rfind('.')
            last_newline = truncated.rfind('\n')
            
            cut_point = max(last_period, last_newline)
            if cut_point > available_text_length * 0.7:  # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ–¥—Ö–æ–¥—è—â–∞—è —Ç–æ—á–∫–∞ –æ–±—Ä–µ–∑–∞–Ω–∏—è
                long_text = truncated[:cut_point + 1] + ".."
            else:
                long_text = truncated[:available_text_length - 3] + "..."
        
        # –°–æ–±–∏—Ä–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
        full_text = (
            f"{long_text}\n\n"
            f"{hashtag_text}\n\n"
            f"üëâ {telegram_link}\n"
            f"üì∫ {rutube_link}"
        )
    
    return full_text

def create_daily_post(post_type="primeta"):
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: —Å–æ–∑–¥–∞—ë—Ç –ø–æ—Å—Ç —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º"""
    now = datetime.now()
    current_day = now.day
    current_month = now.month
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–Ω—è
    day_data = load_data_for_day(post_type, current_day, current_month)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
    title_line2 = None
    if post_type == "saint":
        title_line2 = day_data.get("name", "").upper()
    elif post_type == "hero":
        title_line2 = day_data.get("name", "").upper()
    elif post_type == "actor":
        title_line2 = day_data.get("name", "").upper()
    elif post_type == "holiday":
        title_line2 = day_data.get("title", "").upper()
    elif post_type == "history":
        title_line2 = day_data.get("event", "").upper()
    
    # –°–æ–∑–¥–∞—ë–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
    card_image = create_horizontal_card(post_type, title_line2)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
    timestamp = now.strftime('%Y%m%d_%H%M%S')
    image_filename = f"post_{post_type}_{timestamp}.jpg"
    card_image.save(image_filename, quality=95, optimize=True)
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –¥–ª—è Telegram
    post_text = generate_telegram_post(post_type, day_data)
    
    return image_filename, post_text

def get_post_schedule():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –Ω–∞ –¥–µ–Ω—å"""
    return {
        8: "primeta",   # 08:00 - –ù–∞—Ä–æ–¥–Ω–∞—è –ø—Ä–∏–º–µ—Ç–∞
        9: "saint",     # 09:00 - –°–≤—è—Ç–æ–π –¥–Ω—è
        10: "holiday",  # 10:00 - –ü—Ä–∞–∑–¥–Ω–∏–∫ –¥–Ω—è
        11: "hero",     # 11:00 - –ß—Ç–æ–±—ã –ø–æ–º–Ω–∏–ª–∏
        12: "lunar",    # 12:00 - –õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        13: "wisdom",   # 13:00 - –ú—É–¥—Ä–æ—Å—Ç—å –¥–Ω—è
        14: "history",  # 14:00 - –î–µ–Ω—å –≤ –∏—Å—Ç–æ—Ä–∏–∏
        15: "herbal",   # 15:00 - –¢—Ä–∞–≤–Ω–∏–∫
        16: "art",      # 16:00 - –ò—Å–∫—É—Å—Å—Ç–≤–æ
        17: "food",     # 17:00 - –ö—É—Ö–Ω—è
        18: "house",    # 18:00 - –î–æ–º –∏ —É–∫–ª–∞–¥
        19: "craft",    # 19:00 - –†–µ–º–µ—Å–ª–æ
        20: "actor",    # 20:00 - –°–æ–≤–µ—Ç—Å–∫–∏–µ –∞–∫—Ç—ë—Ä—ã
        21: "advice",   # 21:00 - –°–æ–≤–µ—Ç
        22: "prayer",   # 22:00 - –í–µ—á–µ—Ä–Ω—è—è –º–æ–ª–∏—Ç–≤–∞
    }
