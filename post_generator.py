from PIL import Image, ImageDraw, ImageFont
import os
from datetime import datetime

# === –¶–≤–µ—Ç–∞ ===
BG_DAY = (235, 230, 220)
BG_EVE = (210, 215, 210)
TEXT_COLOR = (40, 35, 30)
ACCENT = (150, 100, 80)

def get_russian_month(m):
    months = ["—è–Ω–≤–∞—Ä—è", "—Ñ–µ–≤—Ä–∞–ª—è", "–º–∞—Ä—Ç–∞", "–∞–ø—Ä–µ–ª—è", "–º–∞—è", "–∏—é–Ω—è",
              "–∏—é–ª—è", "–∞–≤–≥—É—Å—Ç–∞", "—Å–µ–Ω—Ç—è–±—Ä—è", "–æ–∫—Ç—è–±—Ä—è", "–Ω–æ—è–±—Ä—è", "–¥–µ–∫–∞–±—Ä—è"]
    return months[m - 1]

# === –ü—Ä–∞–∑–¥–Ω–∏–∫–∏ ===
ORTHODOX_CALENDAR = {
    (1, 1): ["–û–±—Ä–µ–∑–∞–Ω–∏–µ –ì–æ—Å–ø–æ–¥–Ω–µ", "–ü–∞–º—è—Ç—å —Å–≤—è—Ç–∏—Ç–µ–ª—è –í–∞—Å–∏–ª–∏—è –í–µ–ª–∏–∫–æ–≥–æ"],
    (1, 2): ["–°–æ–±–æ—Ä –ü—Ä–µ—Å–≤—è—Ç–æ–π –ë–æ–≥–æ—Ä–æ–¥–∏—Ü—ã"],
    (1, 7): ["–†–æ–∂–¥–µ—Å—Ç–≤–æ –•—Ä–∏—Å—Ç–æ–≤–æ"]
}
STATE_HOLIDAYS = {
    (1, 1): ["–ù–æ–≤—ã–π –≥–æ–¥"],
    (1, 2): ["–î–µ–Ω—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä—ã –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏"],
    (1, 7): ["–†–æ–∂–¥–µ—Å—Ç–≤–æ –•—Ä–∏—Å—Ç–æ–≤–æ (–ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–æ–µ)"]
}

# === –í–∏–∫—Ç–æ—Ä–∏–Ω—ã ===
QUIZ_DB = {
    1: {
        "question": "1 —è–Ω–≤–∞—Ä—è 1900 –≥–æ–¥–∞ –≤–ø–µ—Ä–≤—ã–µ –≤ –†–æ—Å—Å–∏–∏...",
        "options": [
            "–∑–∞–∑–≤–æ–Ω–∏–ª —Ç–µ–ª–µ—Ñ–æ–Ω –≤ –ö—Ä–µ–º–ª–µ",
            "–±—ã–ª –ø–æ–∫–∞–∑–∞–Ω –ø–µ—Ä–≤—ã–π –∫–∏–Ω–æ—Å–µ–∞–Ω—Å",
            "–∑–∞–ø—É—Å—Ç–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π —Ç—Ä–∞–º–≤–∞–π –≤ –ú–æ—Å–∫–≤–µ"
        ],
        "correct_index": 1,
        "explanation": "–ü–µ—Ä–≤—ã–π –∫–∏–Ω–æ—Å–µ–∞–Ω—Å –ø—Ä–æ—à—ë–ª –≤ –ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ ¬´–ê–∫–≤–∞—Ä–∏—É–º¬ª."
    },
    2: {
        "question": "–ö—Ç–æ –ø–µ—Ä–≤—ã–º –∏–∑ —Ä—É—Å—Å–∫–∏—Ö –∫–Ω—è–∑–µ–π –ø—Ä–∏–Ω—è–ª –∫—Ä–µ—â–µ–Ω–∏–µ?",
        "options": [
            "–í–ª–∞–¥–∏–º–∏—Ä –ö—Ä–∞—Å–Ω–æ–µ –°–æ–ª–Ω—ã—à–∫–æ",
            "–ö–Ω—è–≥–∏–Ω—è –û–ª—å–≥–∞",
            "–Ø—Ä–æ—Å–ª–∞–≤ –ú—É–¥—Ä—ã–π"
        ],
        "correct_index": 1,
        "explanation": "–ö–Ω—è–≥–∏–Ω—è –û–ª—å–≥–∞ –∫—Ä–µ—Å—Ç–∏–ª–∞—Å—å –≤ 957 –≥–æ–¥—É –≤ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–ø–æ–ª–µ."
    }
}

PROVERBS = [
    "–£—Ç—Ä–æ –≤–µ—á–µ—Ä–∞ –º—É–¥—Ä–µ–Ω–µ–µ.",
    "–ù–µ –∏–º–µ–π —Å—Ç–æ —Ä—É–±–ª–µ–π, –∞ –∏–º–µ–π —Å—Ç–æ –¥—Ä—É–∑–µ–π.",
    "–¢–µ—Ä–ø–µ–Ω–∏–µ –∏ —Ç—Ä—É–¥ –≤—Å—ë –ø–µ—Ä–µ—Ç—Ä—É—Ç."
]

MORNING_QUOTES = [
    ("–ù–∞—á–Ω–∏—Ç–µ –¥–µ–Ω—å —Å –¥–æ–±—Ä–æ–≥–æ –¥–µ–ª–∞ ‚Äî –∏ –≤–µ—Å—å –¥–µ–Ω—å –ø–æ–π–¥—ë—Ç –∑–∞ –≤–∞–º–∏.", "–°–≤—è—Ç–∏—Ç–µ–ª—å –¢–∏—Ö–æ–Ω –ó–∞–¥–æ–Ω—Å–∫–∏–π"),
    ("–ù–µ –≤ —Å–∏–ª–µ –ë–æ–≥, –∞ –≤ –ø—Ä–∞–≤–¥–µ.", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ù–µ–≤—Å–∫–∏–π")
]

EVENING_QUOTES = [
    ("–¢—Ä—É–¥ —á–µ–ª–æ–≤–µ–∫–∞ —Å–≤—è—Ç, –∫–æ–≥–¥–∞ –æ–Ω –Ω–∞ –ø–æ–ª—å–∑—É –±–ª–∏–∂–Ω–µ–º—É.", "–ò–≤–∞–Ω –®–º–µ–ª—ë–≤"),
    ("–ö—Ç–æ —Ö–ª–µ–±–æ–º –¥–µ–ª–∏—Ç—Å—è ‚Äî —Ç–æ—Ç —Å –ë–æ–≥–æ–º –≤–æ–¥–∏—Ç—Å—è.", "–ù–∞—Ä–æ–¥–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å")
]

def create_simple_image(text_lines, bg_color=BG_DAY):
    img = Image.new('RGB', (1080, 1350), color=bg_color)
    draw = ImageDraw.Draw(img)
    try:
        font = ImageFont.truetype("CormorantGaramond-Bold.ttf", 70)
    except:
        font = ImageFont.load_default()
    y = 300
    for line in text_lines[:10]:
        draw.text((100, y), line[:40], fill=TEXT_COLOR, font=font)
        y += 80
    path = "post.jpg"
    img.save(path, quality=95)
    return path

def build_caption(lines, hashtags=""):
    full = "\n".join(lines)
    if len(full) > 4000:
        full = full[:3950] + "‚Ä¶"
    return full + "\n\nüëâ –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ ¬´–ù–∞—Ä–æ–¥–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å¬ª –Ω–∞ RuTube.\nüîó https://rutube.ru/channel/23605491\n\n" + hashtags

def create_daily_post(post_type="holiday"):
    now = datetime.now()
    day, month = now.day, now.month
    date_str = f"{day} {get_russian_month(month)}"

    if post_type == "holiday":
        orth = ORTHODOX_CALENDAR.get((day, month), [])
        state = STATE_HOLIDAYS.get((day, month), [])
        lines = ["–î—Ä—É–∑—å—è, —Å–µ–≥–æ–¥–Ω—è ‚Äî –æ—Å–æ–±—ã–π –¥–µ–Ω—å."]
        if orth:
            lines.append("\n‚õ™ –í –ø—Ä–∞–≤–æ—Å–ª–∞–≤–∏–∏ —Å–µ–≥–æ–¥–Ω—è:")
            for o in orth:
                lines.append(f"‚Äî {o}")
        if state:
            lines.append("\nüóìÔ∏è –í –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ:")
            for s in state:
                lines.append(f"‚Äî {s}")
        lines.append("\n–û–±–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ ‚Äî –æ –≤–µ—Ä–µ –∏ –ø–æ—Ä—è–¥–∫–µ.")
        return create_simple_image(lines), build_caption(lines, "#—Å–µ–≥–æ–¥–Ω—è–ø—Ä–∞–∑–¥–Ω–∏–∫ #–Ω–∞—Ä–æ–¥–Ω—ã–π–∫–∞–ª–µ–Ω–¥–∞—Ä—å")

    elif post_type == "quiz":
        quiz_key = (now.timetuple().tm_yday - 1) % len(QUIZ_DB) + 1
        q = QUIZ_DB[quiz_key]
        lines = [
            "üß† –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –¥–Ω—è",
            "",
            f"–î—Ä—É–∑—å—è, –∑–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ {q['question']}",
            "",
            "–ê) " + q['options'][0],
            "–ë) " + q['options'][1],
            "–í) " + q['options'][2],
            "",
            "–ü–∏—à–∏—Ç–µ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏!",
            "–ó–∞–≤—Ç—Ä–∞ ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏ –Ω–æ–≤–∞—è –∑–∞–≥–∞–¥–∫–∞."
        ]
        return create_simple_image(lines), build_caption(lines, "#–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞–¥–Ω—è #–∑–Ω–∞–Ω–∏–µ—Ä–æ—Å—Å–∏–∏")

    elif post_type == "quote_morning":
        idx = (now.timetuple().tm_yday - 1) % len(MORNING_QUOTES)
        quote, author = MORNING_QUOTES[idx]
        lines = ["üó£ –¶–∏—Ç–∞—Ç–∞ –¥–Ω—è", "", f"¬´{quote}¬ª", f"‚Äî {author}"]
        return create_simple_image(lines), build_caption(lines, "#—Ü–∏—Ç–∞—Ç–∞–¥–Ω—è #–º—É–¥—Ä–æ—Å—Ç—å")

    elif post_type == "quote_evening":
        idx = (now.timetuple().tm_yday - 1) % len(EVENING_QUOTES)
        quote, author = EVENING_QUOTES[idx]
        lines = ["üåô –í–µ—á–µ—Ä–Ω—è—è —Ü–∏—Ç–∞—Ç–∞", "", f"¬´{quote}¬ª", f"‚Äî {author}"]
        return create_simple_image(lines), build_caption(lines, "#—Ü–∏—Ç–∞—Ç–∞–¥–Ω—è #–≤–µ—á–µ—Ä–Ω—è—è–º—É–¥—Ä–æ—Å—Ç—å")

    elif post_type == "evening_prayer":
        lines = [
            "–î—Ä—É–∑—å—è, –Ω–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è —Ç–∏—à–∏–Ω—ã.",
            "",
            "–í–µ—á–µ—Ä–æ–º –Ω–∞—à–∏ –¥–µ–¥—ã —á–∏—Ç–∞–ª–∏:",
            "¬´–ì–æ—Å–ø–æ–¥–∏, –±–ª–∞–≥–æ—Å–ª–æ–≤–∏ –∏—Å—Ö–æ–¥—è—â–∏–π –¥–µ–Ω—å,",
            "—Å–æ—Ö—Ä–∞–Ω–∏ –¥–æ–º –æ—Ç –±–µ–¥—ã, —Å–µ–º—å—é ‚Äî –æ—Ç —Ç—Ä–µ–≤–æ–≥–∏,",
            "–¥–∞–π –ø–æ–∫–æ–π –¥—É—à–µ –∏ –∫—Ä–µ–ø–∫–∏–π —Å–æ–Ω. –ê–º–∏–Ω—å.¬ª",
            "",
            "–ü—É—Å—Ç—å —ç—Ç–∞ –º–æ–ª–∏—Ç–≤–∞ —Å–æ–≥—Ä–µ–µ—Ç –≤–∞—à –¥–æ–º."
        ]
        return create_simple_image(lines), build_caption(lines, "#–≤–µ—á–µ—Ä–Ω—è—è–º–æ–ª–∏—Ç–≤–∞ #—Å–ø–æ–∫–æ–π–Ω–æ–π–Ω–æ—á–∏")

    elif post_type == "proverb":
        idx = (now.timetuple().tm_yday - 1) % len(PROVERBS)
        prov = PROVERBS[idx]
        lines = [
            "–î—Ä—É–∑—å—è, –∑–Ω–∞–µ—Ç–µ, –≤ –Ω–∞—Ä–æ–¥–µ –≥–æ–≤–æ—Ä–∏–ª–∏:",
            "",
            f"¬´{prov}¬ª",
            "",
            "–≠—Ç–∞ –º—É–¥—Ä–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≤–µ–∫–∞–º–∏.",
            "–ü—É—Å—Ç—å –æ–Ω–∞ –ª—è–∂–µ—Ç –≤ –æ—Å–Ω–æ–≤—É –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è."
        ]
        return create_simple_image(lines), build_caption(lines, "#–Ω–∞—Ä–æ–¥–Ω–∞—è–º—É–¥—Ä–æ—Å—Ç—å #–ø–æ—Å–ª–æ–≤–∏—Ü–∞–¥–Ω—è")

    elif post_type == "primeta":
        lines = [
            "–î—Ä—É–∑—å—è, –∑–Ω–∞–µ—Ç–µ, –≤ –Ω–∞—Ä–æ–¥–µ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ç–∞:",
            "",
            "–ï—Å–ª–∏ —É—Ç—Ä–æ —è—Å–Ω–æ–µ ‚Äî –∫ –¥–æ–±—Ä–æ–º—É —É—Ä–æ–∂–∞—é,",
            "–µ—Å–ª–∏ –≤–µ—Ç–µ—Ä —Å –≤–æ—Å—Ç–æ–∫–∞ ‚Äî –∫ –º–æ—Ä–æ–∑—É.",
            "",
            "–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ø—Ä–∏—Ä–æ–¥—É ‚Äî –æ–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç —Å –Ω–∞–º–∏."
        ]
        return create_simple_image(lines), build_caption(lines, "#–Ω–∞—Ä–æ–¥–Ω–∞—è–ø—Ä–∏–º–µ—Ç–∞ #–ø—Ä–∏—Ä–æ–¥–∞")

    elif post_type == "saint":
        lines = [
            "–î—Ä—É–∑—å—è, —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–∞—è –¶–µ—Ä–∫–æ–≤—å —á—Ç–∏—Ç –ø–∞–º—è—Ç—å —Å–≤—è—Ç–æ–≥–æ.",
            "",
            "–í –Ω–∞—Ä–æ–¥–µ –≥–æ–≤–æ—Ä–∏–ª–∏: –∫—Ç–æ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –ø–æ–º–æ–ª–∏—Ç—Å—è ‚Äî",
            "—Ç–æ–º—É —Å–≤—è—Ç–æ–π –ø–æ–º–æ–∂–µ—Ç –≤ –¥–æ–±—Ä—ã—Ö –¥–µ–ª–∞—Ö.",
            "",
            "–ü—É—Å—Ç—å –µ–≥–æ –∑–∞—Å—Ç—É–ø–Ω–∏—á–µ—Å—Ç–≤–æ –±—É–¥–µ—Ç —Å –≤–∞–º–∏."
        ]
        return create_simple_image(lines), build_caption(lines, "#—Å–≤—è—Ç–æ–π–¥–Ω—è #–º–æ–ª–∏—Ç–≤–∞")

    elif post_type == "ussr":
        lines = [
            "–ó–Ω–∞–µ—Ç–µ, —Å–µ–≥–æ–¥–Ω—è ‚Äî –¥–µ–Ω—å –ø–∞–º—è—Ç–∏ –≥–µ—Ä–æ—è –û—Ç–µ—á–µ—Å—Ç–≤–∞.",
            "",
            "–û–Ω –æ—Ç–¥–∞–ª –∂–∏–∑–Ω—å –∑–∞ –†–æ–¥–∏–Ω—É, –Ω–æ –µ–≥–æ –ø–æ–¥–≤–∏–≥ –∂–∏–≤—ë—Ç –≤ —Å–µ—Ä–¥—Ü–∞—Ö.",
            "",
            "–°–ª–∞–≤–∞ –≥–µ—Ä–æ—è–º ‚Äî –≤ –Ω–∞—à–µ–π –ø–∞–º—è—Ç–∏ –∏ —á–µ—Å—Ç–∏."
        ]
        return create_simple_image(lines), build_caption(lines, "#–≥–µ—Ä–æ–π–æ—Ç–µ—á–µ—Å—Ç–≤–∞ #—Å–ª–∞–≤–∞")

    elif post_type == "lunar":
        lines = [
            "–î—Ä—É–∑—å—è, —Å–µ–≥–æ–¥–Ω—è –õ—É–Ω–∞ –≤ —É–±—ã–≤–∞—é—â–µ–π —Ñ–∞–∑–µ.",
            "",
            "–í –Ω–∞—Ä–æ–¥–µ —Å–æ–≤–µ—Ç–æ–≤–∞–ª–∏: –Ω–µ –Ω–∞—á–∏–Ω–∞—Ç—å –Ω–æ–≤—ã—Ö –¥–µ–ª,",
            "–∞ –ª—É—á—à–µ –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤ –ø–æ—Ä—è–¥–æ–∫ –¥–æ–º –∏ –¥—É—à—É.",
            "",
            "–õ—É–Ω–∞ ‚Äî –∑–µ—Ä–∫–∞–ª–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–∏—Ä–∞."
        ]
        return create_simple_image(lines), build_caption(lines, "#–ª—É–Ω–Ω—ã–π–∫–∞–ª–µ–Ω–¥–∞—Ä—å #–ª—É–Ω–∞")

    elif post_type == "saint_tomorrow":
        lines = [
            "–î—Ä—É–∑—å—è, –∑–∞–≤—Ç—Ä–∞ –¶–µ—Ä–∫–æ–≤—å —á—Ç–∏—Ç –Ω–æ–≤–æ–≥–æ —Å–≤—è—Ç–æ–≥–æ.",
            "",
            "–£–∂–µ —Å–µ–≥–æ–¥–Ω—è –º–æ–∂–Ω–æ –ø–æ–º–æ–ª–∏—Ç—å—Å—è –µ–º—É ‚Äî",
            "—á—Ç–æ–±—ã –æ–Ω —Å—Ç–∞–ª –≤–∞—à–∏–º –Ω–µ–±–µ—Å–Ω—ã–º –ø–æ–∫—Ä–æ–≤–∏—Ç–µ–ª–µ–º.",
            "",
            "–°–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏. –î–∞ —Ö—Ä–∞–Ω–∏—Ç –≤–∞—Å –ì–æ—Å–ø–æ–¥—å."
        ]
        return create_simple_image(lines), build_caption(lines, "#—Å–≤—è—Ç–æ–π–¥–Ω—è #—Å–ø–æ–∫–æ–π–Ω–æ–π–Ω–æ—á–∏")

    return create_simple_image(["–ü–æ—Å—Ç –¥–Ω—è"]), "–ü–æ—Å—Ç\n\nüëâ –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ RuTube.\nüîó https://rutube.ru/channel/23605491\n\n#–Ω–∞—Ä–æ–¥–Ω—ã–π–∫–∞–ª–µ–Ω–¥–∞—Ä—å"
